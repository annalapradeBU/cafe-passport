<!-- File: show_cafe.html -->
<!-- Author: Anna LaPrade (alaprade@bu.edu), 11/26/2025 -->
<!-- Description: the favorite item html template for the project (cafe passport) app -->

<!-- extend from the base template -->
{% extends "project/base.html" %}

{% block content %}

<div class="card cafe-detail">
    <div class="cafe-header-group">
        <h1>{{ cafe.name }} â˜•âœ¨</h1>
        
        <!-- show the visited badge if visits are associated with this cafe, show unvisted otherwise -->
        {% if has_visited %}
            <span class="status-badge status-visited">
                âœ… Visited!
            </span>
        {% else %}
            <span class="status-badge status-unvisited">
                ğŸ‘€ Unvisited
            </span>
        {% endif %}
    </div> 

    <!-- display image or default image -->
    <img src="{{ cafe.image|default:'https://img.freepik.com/premium-vector/cute-doodle-cup-coffee-saucer-isolated-white-background_361363-219.jpg' }}" 
            alt="{{ cafe.name }}" 
            class="cafe-detail-img">

    <p><strong>Address:</strong> {{ cafe.address }}</p>

    <!-- display optional feilds' data if they were present -->
    {% if cafe.description %}
        <p><strong>Description:</strong> {{ cafe.description }}</p>
    {% endif %}

    {% if cafe.google_rating %}
        <p><strong>Google Rating:</strong> â­ {{ cafe.google_rating }}</p>
    {% endif %}

    <h3>Tags</h3>
    <div class="tags-container">
        {% for tag in cafe.tags.all %}
            <span class="tag">{{ tag.name }}</span>
        {% empty %}
            <p>No tags yet!</p>
        {% endfor %}
    </div>

    <div class="wishlist-actions" >
        <br>
        <!-- if it's a wishlist item, allow removal. if it's not, allow addition  -->
        {% if wishlist_item %}
            
            <span class="status-badge status-visited">
                ğŸ’– On your Wishlist!
            </span>

            <br>
            
            <!-- form to remove a cafe from the wishlist -->
            <form method="POST" action="{% url 'remove_from_wishlist' cafe_pk=cafe.pk %}" class="action-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-small">
                    Remove ğŸ—‘ï¸
                </button>
            </form>
        
        {% else %}
            
            <span class="status-badge status-unvisited">
                ğŸŒŸ Not on your wishlist
            </span>

            <br>
            
            <!-- form to add a cafe to the wishlist -->
            <form method="POST" action="{% url 'add_to_wishlist_direct' cafe_pk=cafe.pk %}" class="action-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn-small">
                    Add to Wishlist â•
                </button>
            </form>
            
        {% endif %}
        
    </div>

    {% if request.user.is_authenticated %}
        <div class="wishlist-actions" style="margin-top: 20px; border-top: 1px solid var(--accent); padding-top: 15px; display: flex; gap: 10px;">
            
            <a href="{% url 'update_cafe' pk=cafe.pk %}" class="btn btn-primary btn-small">
                Edit Cafe âœï¸
            </a>
            
            {% if request.user.is_staff or request.user.is_superuser %}
                <a href="{% url 'delete_cafe' pk=cafe.pk %}" class="btn btn-danger btn-small">
                    Delete Cafe âŒ
                </a>
            {% endif %}
            
        </div>
    {% endif %}
</div>


<!-- cafe visit display -->
<h3>Your Visits</h3>

<div class="visits-container">


    <!-- button to faccilitate visit creation -->
    <div class="visit-card">
        <img src="https://static.thenounproject.com/png/781978-200.png" class="visit-card-img" style="filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(93deg) brightness(103%) contrast(103%);">
        <a href="{% url 'create_visit' cafe.pk %}" class="btn">Add Visit to {{ cafe.name }}</a>

    </div>

    
    <!-- loop through the visits and make a card for each with data-->
    {% for v in visits %}
        <div class="visit-card">
            <a href="{% url 'visit_detail' v.visit.id %}">
                <img src="{{ v.image_url }}" class="visit-card-img">
                <p>{{ v.visit.date_visited }}</p>
            </a>
        </div>
    {% endfor %}

    

</div>


{% endblock %}
